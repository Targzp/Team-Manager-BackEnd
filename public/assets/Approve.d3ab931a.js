var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,p=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,u=(e,a)=>{for(var l in a||(a={}))r.call(a,l)&&p(e,l,a[l]);if(t)for(var l of t(a))o.call(a,l)&&p(e,l,a[l]);return e},i=(e,t)=>a(e,l(t));import{L as n,M as d,A as s,C as m,r as y,o as f,c,g as b,d as v,e as g,w,N as _,F as h,a as N,b as S,t as k,f as D,_ as T}from"./vendor.b1d65a4d.js";import{u as j,a as C}from"./index.605a31b6.js";import"./zh-cn.a582dec9.js";const O={class:"leave-manager"},M={class:"query-form"},U=D("查询"),V=D("重置"),x={class:"base-table"},z=D("审核"),A={class:"dialog-footer"},P=D("驳回"),$=D("通过"),q={setup(e){const a=n(),l=d({applyState:1}),t=s([]),r=d({pageNum:1,pageSize:10}),o=d({}),p=d({}),D=s(!1),q=a.state.userInfo,F=s(null),I=s(null),L=d([{label:"单号",prop:"orderNo",width:"100",align:"center"},{label:"申请人",prop:"",formatter:e=>e.applyUser.userName,align:"center"},{label:"休假时间",prop:"",formatter:e=>`${j.formateDate(new Date(e.startTime),"yyyy-MM-dd")} 到 ${j.formateDate(new Date(e.endTime),"yyyy-MM-dd")}`,width:"175"},{label:"休假时长",prop:"leaveTime"},{label:"休假类型",prop:"applyType",formatter:(e,a,l)=>({1:"事假",2:"调休",3:"年假"}[l])},{label:"休假原因",prop:"reasons"},{label:"申请时间",prop:"createTime",formatter:(e,a,l)=>j.formateDate(new Date(l)),width:"150"},{label:"审批人",prop:"auditUsers",width:"170"},{label:"当前审批人",prop:"curAuditUserName"},{label:"审批状态",prop:"applyState",formatter:(e,a,l)=>({1:"待审批",2:"审批中",3:"审批拒绝",4:"审批通过",5:"作废"}[l])}]),E=d({remark:[{required:!0,message:"请输入审核备注",trigger:"blur"}]});m((()=>{G()}));const B=e=>{r.pageNum=e,G()},G=async function(){let e=i(u(u({},l),r),{type:"approve"});try{const{list:a,page:l}=await C.getApplyList(e);return t.value=a,r.total=l.total,a}catch(a){console.log(a)}},H=e=>{e.resetFields()},J=e=>{I.value.validate((async l=>{if(l)try{let l=i(u({action:e},o),{_id:p._id});await C.approveSubmit(l)&&(T({message:"审核完毕",duration:2e3,type:"success"}),D.value=!1,H(I.value),G(),a.commit("changeNoticeCount",-1))}catch(t){console.log(t)}}))};return(e,a)=>{const i=y("el-option"),n=y("el-select"),d=y("el-form-item"),s=y("el-button"),m=y("el-form"),T=y("el-table-column"),C=y("el-table"),K=y("el-pagination"),Q=y("el-input"),R=y("el-dialog");return f(),c("div",O,[b(" 查询申请区域 "),v("div",M,[g(m,{inline:!0,model:_(l),ref:F},{default:w((()=>[g(d,null,{default:w((()=>[g(n,{modelValue:_(l).applyState,"onUpdate:modelValue":a[0]||(a[0]=e=>_(l).applyState=e),label:"审批状态",prop:"applyState"},{default:w((()=>[g(i,{value:"",label:"全部"}),g(i,{value:1,label:"待审批"}),g(i,{value:2,label:"审批中"}),g(i,{value:3,label:"审批拒绝"}),g(i,{value:4,label:"审批通过"}),g(i,{value:5,label:"作废"})])),_:1},8,["modelValue"])])),_:1}),g(d,null,{default:w((()=>[g(s,{type:"primary",onClick:G},{default:w((()=>[U])),_:1}),g(s,{onClick:a[1]||(a[1]=()=>H(F.value))},{default:w((()=>[V])),_:1})])),_:1})])),_:1},8,["model"])]),b(" 申请列表区域 "),v("div",x,[g(C,{"max-height":"350",data:t.value},{default:w((()=>[(f(!0),c(h,null,N(_(L),(e=>(f(),S(T,{key:e.prop,prop:e.prop,label:e.label,width:e.width,formatter:e.formatter,align:e.align},null,8,["prop","label","width","formatter","align"])))),128)),g(T,{label:"操作",width:"150"},{default:w((e=>[e.row.curAuditUserName==_(q).userName&&[1,2].includes(e.row.applyState)?(f(),S(s,{key:0,size:"mini",plain:"",onClick:a=>(e=>{D.value=!0;let a=u({},e);a.applyTypeName={1:"事假",2:"调休",3:"年假"}[a.applyType],a.time=`${j.formateDate(new Date(a.startTime),"yyyy-MM-dd")}到${j.formateDate(new Date(a.endTime),"yyyy-MM-dd")}`,a.applyStateName={1:"待审批",2:"审批中",3:"审批拒绝",4:"审批通过",5:"作废"}[a.applyState],Object.assign(p,a)})(e.row)},{default:w((()=>[z])),_:2},1032,["onClick"])):b("v-if",!0)])),_:1})])),_:1},8,["data"]),g(K,{class:"pagination",layout:"prev, pager, next",total:_(r).total,"page-size":_(r).pageSize,onCurrentChange:B},null,8,["total","page-size"])]),b(" 休假申请详情表单 "),g(R,{title:"审核",modelValue:D.value,"onUpdate:modelValue":a[5]||(a[5]=e=>D.value=e),center:!0,width:"700px"},{footer:w((()=>[v("span",A,[g(s,{type:"danger",onClick:a[3]||(a[3]=e=>J("refuse"))},{default:w((()=>[P])),_:1}),g(s,{type:"primary",onClick:a[4]||(a[4]=e=>J("pass"))},{default:w((()=>[$])),_:1})])])),default:w((()=>[g(m,{"label-width":"100px","label-suffix":":",model:_(o),rules:_(E),ref:I},{default:w((()=>[g(d,{label:"申请人"},{default:w((()=>[v("div",null,k(_(p).applyUser.userName),1)])),_:1}),g(d,{label:"休假类型"},{default:w((()=>[v("div",null,k(_(p).applyTypeName),1)])),_:1}),g(d,{label:"休假时间"},{default:w((()=>[v("div",null,k(_(p).time),1)])),_:1}),g(d,{label:"休假时长"},{default:w((()=>[v("div",null,k(_(p).leaveTime),1)])),_:1}),g(d,{label:"休假原因"},{default:w((()=>[v("div",null,k(_(p).reasons),1)])),_:1}),g(d,{label:"审批状态"},{default:w((()=>[v("div",null,k(_(p).applyStateName),1)])),_:1}),g(d,{label:"审批人"},{default:w((()=>[v("div",null,k(_(p).curAuditUserName),1)])),_:1}),g(d,{label:"备注",prop:"remark"},{default:w((()=>[g(Q,{type:"textarea",row:3,placeholder:"请输入审核备注",modelValue:_(o).remark,"onUpdate:modelValue":a[2]||(a[2]=e=>_(o).remark=e)},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["modelValue"])])}}};export{q as default};
