var e=Object.defineProperty,t=Object.defineProperties,l=Object.getOwnPropertyDescriptors,a=Object.getOwnPropertySymbols,r=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,s=(t,l,a)=>l in t?e(t,l,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[l]=a,d=(e,t)=>{for(var l in t||(t={}))r.call(t,l)&&s(e,l,t[l]);if(a)for(var l of a(t))o.call(t,l)&&s(e,l,t[l]);return e};import{r as i,O as n,o as p,c as u,d as m,e as c,w as h,P as f,F as b,a as g,b as w,f as y}from"./vendor.b1d65a4d.js";const F={name:"dept",data(){return{queryForm:{},deptList:[],allDeptList:[],deptForm:{parentId:[null]},userList:[],showModel:!1,action:"",columns:[{label:"部门名称",prop:"deptName",width:150,align:"center"},{label:"负责人",prop:"userName"},{label:"更新时间",prop:"updateTime",formatter:(e,t,l)=>this.$utils.formateDate(new Date(l))},{label:"创建时间",prop:"createTime",formatter:(e,t,l)=>this.$utils.formateDate(new Date(l))}],rules:{deptName:[{required:!0,message:"请输入部门名称",trigger:"blur"}],user:[{required:!0,message:"请选择负责人",trigger:"blur"}]}}},mounted(){this.getDeptList(),this.getAllUserList()},methods:{async getDeptList(){try{let e=d({},this.queryForm),t=null,l=null;e.deptName&&(t=await this.$api.getDeptList(e)),l=await this.$api.getDeptList(),this.allDeptList=l,this.deptList=t||l}catch(e){throw new Error(e)}},async getAllUserList(){try{const e=await this.$api.getAllUserList();this.userList=e}catch(e){throw new Error(e)}},handleQuery(){this.getDeptList()},handleReset(e){this.$refs[e].resetFields()},handleUser(e){const[t,l,a]=e.split("/");Object.assign(this.deptForm,{userId:t,userName:l,userEmail:a})},handleAdd(){this.showModel=!0,this.action="create"},handleEdit(e){this.showModel=!0,this.action="edit",this.$nextTick((()=>{const{_id:t,parentId:l,deptName:a,userId:r,userName:o,userEmail:s}=e;this.deptForm={_id:t,parentId:l,deptName:a,user:`${r}/${o}/${s}`,userEmail:s}}))},async handleDelete(e){const t={_id:e._id,action:"delete"};try{await this.$api.deptSubmit(t),this.$message.success("删除成功"),this.getDeptList()}catch(l){throw new Error(l)}},handleClose(){this.showModel=!1,this.handleReset("dialogForm")},handleSubmit(){this.$refs.dialogForm.validate((async e=>{if(e)try{let e=(a=d({},this.deptForm),r={action:this.action},t(a,l(r)));delete e.user;await this.$api.deptSubmit(e);this.$message.success("操作成功"),this.handleClose(),this.getDeptList()}catch(o){throw new Error(o)}var a,r}))}}},_={class:"dept-manager"},k={class:"query-form"},L=y("查询"),C=y("重置"),V={class:"base-table"},$={class:"action"},D=y("创建"),N=y("编辑"),v=y("删除"),E={class:"dialog-footer"},I=y("取 消"),O=y("确 定");F.render=function(e,t,l,a,r,o){const s=i("el-input"),d=i("el-form-item"),y=i("el-button"),F=i("el-form"),U=i("el-table-column"),j=i("el-table"),q=i("el-cascader"),M=i("el-option"),P=i("el-select"),S=i("el-dialog"),A=n("has");return p(),u("div",_,[m("div",k,[c(F,{inline:!0,model:r.queryForm,ref:"validateForm"},{default:h((()=>[c(d,{label:"部门名称",prop:"deptName"},{default:h((()=>[c(s,{modelValue:r.queryForm.deptName,"onUpdate:modelValue":t[0]||(t[0]=e=>r.queryForm.deptName=e),placeholder:"请输入部门名称"},null,8,["modelValue"])])),_:1}),c(d,null,{default:h((()=>[c(y,{type:"primary",onClick:o.handleQuery},{default:h((()=>[L])),_:1},8,["onClick"]),c(y,{onClick:t[1]||(t[1]=()=>o.handleReset("validateForm"))},{default:h((()=>[C])),_:1})])),_:1})])),_:1},8,["model"])]),m("div",V,[m("div",$,[f(c(y,{type:"primary",onClick:o.handleAdd},{default:h((()=>[D])),_:1},8,["onClick"]),[[A,"dept-create"]])]),c(j,{"max-height":"350",stripe:"",data:r.deptList,"row-key":"_id","tree-props":{children:"children"}},{default:h((()=>[(p(!0),u(b,null,g(r.columns,(e=>(p(),w(U,{key:e.prop,prop:e.prop,label:e.label,width:e.width,align:e.align,formatter:e.formatter},null,8,["prop","label","width","align","formatter"])))),128)),c(U,{label:"操作",width:"250",align:"center"},{default:h((e=>[f(c(y,{size:"mini",plain:"",onClick:t=>o.handleEdit(e.row)},{default:h((()=>[N])),_:2},1032,["onClick"]),[[A,"dept-edit"]]),f(c(y,{type:"danger",size:"mini",onClick:t=>o.handleDelete(e.row)},{default:h((()=>[v])),_:2},1032,["onClick"]),[[A,"dept-delete"]])])),_:1})])),_:1},8,["data"])]),c(S,{title:"edit"==r.action?"部门编辑":"创建部门",modelValue:r.showModel,"onUpdate:modelValue":t[6]||(t[6]=e=>r.showModel=e),"close-on-click-modal":!1,"show-close":!1,"close-on-press-escape":!1,center:!0},{footer:h((()=>[m("span",E,[c(y,{onClick:o.handleClose},{default:h((()=>[I])),_:1},8,["onClick"]),c(y,{type:"primary",onClick:o.handleSubmit},{default:h((()=>[O])),_:1},8,["onClick"])])])),default:h((()=>[c(F,{ref:"dialogForm",model:r.deptForm,"label-width":"100px",rules:r.rules},{default:h((()=>[c(d,{label:"上级部门",prop:"parentId"},{default:h((()=>[c(q,{modelValue:r.deptForm.parentId,"onUpdate:modelValue":t[2]||(t[2]=e=>r.deptForm.parentId=e),placeholder:"请选择上级部门",options:r.allDeptList,props:{checkStrictly:!0,value:"_id",label:"deptName"},clearable:""},null,8,["modelValue","options"])])),_:1}),c(d,{label:"部门名称",prop:"deptName"},{default:h((()=>[c(s,{modelValue:r.deptForm.deptName,"onUpdate:modelValue":t[3]||(t[3]=e=>r.deptForm.deptName=e),placeholder:"请输入部门名称"},null,8,["modelValue"])])),_:1}),c(d,{label:"负责人",prop:"user"},{default:h((()=>[c(P,{modelValue:r.deptForm.user,"onUpdate:modelValue":t[4]||(t[4]=e=>r.deptForm.user=e),placeholder:"请选择部门负责人",onChange:o.handleUser},{default:h((()=>[(p(!0),u(b,null,g(r.userList,(e=>(p(),w(M,{key:e.userId,value:`${e.userId}/${e.userName}/${e.userEmail}`,label:e.userName},null,8,["value","label"])))),128))])),_:1},8,["modelValue","onChange"])])),_:1}),c(d,{label:"负责人邮箱",prop:"userEmail"},{default:h((()=>[c(s,{modelValue:r.deptForm.userEmail,"onUpdate:modelValue":t[5]||(t[5]=e=>r.deptForm.userEmail=e),disabled:""},null,8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["title","modelValue"])])};export{F as default};
